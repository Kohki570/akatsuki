<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>あかつき</title>
</head>
<body>
    <input type="file" id="file-upload" multiple>
    <div id="file-list"></div>
    <button id="play-button">再生</button>
    <audio id="audio-player" autoplay></audio>

    <script>
        let files;
        let lastPlayedFileNumber = null;
        var kaminokuisplaying = 0;
        var onmusic = 0;

        document.getElementById('file-upload').addEventListener('change', function(e) {
            files = e.target.files;
            playFileStartingWith('100');
            for (let i = 0; i < files.length; i++) {
                if (files[i].name.startsWith('100')) {
                    fileToPlay = files[i];

                    // ファイル名の最初の4文字と最後の4文字を除外して表示
                    const displayName = files[i].name.substring(4, files[i].name.length - 4);
                    document.getElementById('file-list').innerText = displayName;
                    break;
                }
            }
        });
//ここから
        document.getElementById('play-button').addEventListener('click', function() {
            if(lastPlayedFileNumber === '100'){
                playFileStartingWith('228');
                
            }
            else if(kaminokuisplaying==0 && onmusic==1){
                document.getElementById('audio-player').pause();
                document.getElementById('audio-player').currentTime = 0;
                onmusic = 0;
                
            }
            else if (kaminokuisplaying == 0 && onmusic==0){
                document.getElementById('audio-player').play();
                onmusic=1;
            }
            else if (kaminokuisplaying == 1 && onmusic==1){
                document.getElementById('audio-player').pause();
                onmusic = 0;
            }


            else if (kaminokuisplaying == 1 && onmusic == 0) {
                let nextFileNumber = parseInt(lastPlayedFileNumber, 10) + 128;
                playFileStartingWith(nextFileNumber.toString().padStart(3, '0'));
                kaminokuisplaying=0;
                onmusic=1;
            } 

        });

        document.getElementById('audio-player').addEventListener('ended', function() {
            kaminokuisplaying = 1;
            onmusic = 1;
            if (lastPlayedFileNumber === '228') {
                setTimeout(function() {
                    let kaminoku = "000";
                    playFileStartingWith(kaminoku);
                }, 1000);
            } else if (lastPlayedFileNumber === '128' || lastPlayedFileNumber === '256') {
                setTimeout(function() {
                    let kaminoku ="001";
                    playFileStartingWith(kaminoku);
                }, 1000);
                
            }
        });

//ここまで

        function playFileStartingWith(prefix) {
            if (files) {
                for (let i = 0; i < files.length; i++) {
                    if (files[i].name.startsWith(prefix)) {
                        lastPlayedFileNumber = prefix;
                        const audioPlayer = document.getElementById('audio-player');
                        audioPlayer.src = URL.createObjectURL(files[i]);
                        audioPlayer.load();
                        audioPlayer.play();
                        break;
                    }
                }
            }
        }
    </script>
</body>
</html>
